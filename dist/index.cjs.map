{"version":3,"sources":["../src/server/firebase-session.ts"],"names":[],"mappings":";;;AAUO,IAAM,4BAAA,GAA+B","file":"index.cjs","sourcesContent":["/**\n * Firebase session cookie helpers (server-only).\n *\n * We use Firebase Admin to create and verify session cookies. This enables server-side auth checks\n * (redirects, API protection) without relying on client state.\n */\nimport type { DecodedIdToken } from 'firebase-admin/auth';\nimport type { ReadonlyRequestCookies } from 'next/dist/server/web/spec-extension/adapters/request-cookies';\nimport { firebaseAdminAuth } from './firebase-admin';\n\nexport const FIREBASE_SESSION_COOKIE_NAME = '__session';\n\n// 5 days is a common default; adjust as needed.\nconst SESSION_EXPIRES_IN_MS = 1000 * 60 * 60 * 24 * 5;\n\nexport interface VerifiedFirebaseUser {\n  uid: string;\n  email?: string;\n  name?: string;\n  picture?: string;\n  claims: DecodedIdToken;\n}\n\nexport function getSessionCookieOptions() {\n  const isProduction = process.env.NODE_ENV === 'production';\n\n  return {\n    httpOnly: true,\n    secure: isProduction,\n    sameSite: 'lax' as const,\n    path: '/',\n    maxAge: Math.floor(SESSION_EXPIRES_IN_MS / 1000),\n  };\n}\n\nexport async function createFirebaseSessionCookie(idToken: string): Promise<string> {\n  return await firebaseAdminAuth.createSessionCookie(idToken, {\n    expiresIn: SESSION_EXPIRES_IN_MS,\n  });\n}\n\nexport async function verifyFirebaseSessionCookie(sessionCookie: string): Promise<DecodedIdToken> {\n  // checkRevoked=true ensures a revoked session is treated as invalid.\n  return await firebaseAdminAuth.verifySessionCookie(sessionCookie, true);\n}\n\nexport async function getVerifiedFirebaseUserFromCookies(\n  cookies: ReadonlyRequestCookies,\n): Promise<VerifiedFirebaseUser | null> {\n  const sessionCookie = cookies.get(FIREBASE_SESSION_COOKIE_NAME)?.value;\n  if (!sessionCookie) return null;\n\n  try {\n    const claims = await verifyFirebaseSessionCookie(sessionCookie);\n\n    return {\n      uid: claims.uid,\n      email: claims.email,\n      name: claims.name,\n      picture: claims.picture,\n      claims,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function revokeFirebaseUserSessions(uid: string): Promise<void> {\n  await firebaseAdminAuth.revokeRefreshTokens(uid);\n}\n\n"]}